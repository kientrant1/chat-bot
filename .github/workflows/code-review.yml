name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        run: pip install openai

      - name: AI Code Review
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python << 'EOF'
          from openai import OpenAI
          client = OpenAI()

          import subprocess

          # get diff from pull request
          diff = subprocess.check_output(["git", "diff", "origin/main"]).decode()

          prompt = f"Please do code review following code:\n{diff}"

          response = client.chat.completions.create(
              model="gpt-4.1",
              messages=[{"role": "user", "content": prompt}],
          )

          print("AI Review:")
          print(response.choices[0].message.content)
          EOF
